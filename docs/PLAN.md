# План внедрения VK Video Publisher

## Цель проекта
Публикация видео из экспорта Telegram Desktop (Windows) в VK Video с использованием Python и библиотеки python273/vk_api.

## Этапы разработки

### Этап 1: Структурирование проекта ✅
- [x] Создать структуру проекта
- [x] Инициализировать git репозиторий
- [x] Настроить виртуальную среду
- [x] Создать requirements.txt

### Этап 2: Парсинг экспорта Telegram ✅
- [x] Реализовать парсер HTML экспорта
  - [x] Извлечение сообщений из HTML
  - [x] Поиск прикрепленных видеофайлов (папка video_files/)
  - [x] Сопоставление сообщений и файлов
  - [x] Парсинг дат из атрибута title
- [x] Реализовать парсер JSON экспорта
  - [x] Парсинг структуры JSON (result.json с массивом messages)
  - [x] Извлечение метаданных сообщений (дата, текст, файл)
  - [x] Поиск видеофайлов в структуре (поле file в папке files/)
  - [x] Обработка текста из массива (строки и объекты с типами)
- [x] Создать общий интерфейс для парсеров (BaseParser)
- [x] Валидация существования файлов

### Этап 3: Формирование метаданных видео ✅
- [x] Создать систему заголовков (title generators)
  - [x] Базовый генератор заголовков
  - [x] Генераторы для ЕГЭ (темы и задания)
  - [x] Генераторы для Python (темы и задания)
  - [x] Автоматические генераторы (определяют тип контента)
  - [x] Фабрика генераторов для регистрации и выбора
- [x] Извлечение описания из текста сообщения
- [x] Парсинг даты видео из сообщения
- [x] Создание модели данных для видео

### Этап 4: Публикация в VK Video ✅
- [x] Настройка аутентификации VK API (через .env файл)
- [x] Реализация загрузки видео через VkUpload
- [x] Обработка ошибок загрузки
- [x] Логирование процесса публикации
- [x] Поддержка повторных попыток при ошибках
- [x] Задержки между загрузками для предотвращения блокировок
- [x] CLI интерфейс для публикации

### Этап 5: Интеграция и CLI
- [ ] Создать CLI интерфейс
- [ ] Конфигурационный файл
- [ ] Обработка множественных экспортов одного канала
- [ ] Прогресс-бар и отчеты

### Этап 6: Тестирование и документация
- [ ] Unit тесты для парсеров
- [ ] Unit тесты для генераторов заголовков
- [ ] Интеграционные тесты
- [ ] Документация по использованию
- [ ] Примеры конфигурации

## Структура проекта

```
VK_Importer/
├── src/
│   ├── __init__.py
│   ├── parsers/
│   │   ├── __init__.py
│   │   ├── base.py          # Базовый класс парсера
│   │   ├── html_parser.py   # Парсер HTML экспорта
│   │   └── json_parser.py   # Парсер JSON экспорта
│   ├── title_generators/
│   │   ├── __init__.py
│   │   ├── base.py          # Базовый класс генератора заголовков
│   │   └── generators.py    # Реализации генераторов
│   ├── models/
│   │   ├── __init__.py
│   │   └── video.py         # Модель данных видео
│   ├── publisher/
│   │   ├── __init__.py
│   │   └── vk_publisher.py   # Публикация в VK Video
│   └── utils/
│       ├── __init__.py
│       └── file_utils.py    # Утилиты для работы с файлами
├── config/
│   └── config.example.yaml  # Пример конфигурации
├── tests/
│   ├── __init__.py
│   ├── test_parsers.py
│   ├── test_title_generators.py
│   └── test_publisher.py
├── .gitignore
├── requirements.txt
├── README.md
└── main.py                  # Точка входа CLI
```

## Технические требования

### Зависимости
- Python 3.8+
- vk_api (python273/vk_api)
- BeautifulSoup4 (для парсинга HTML)
- PyYAML (для конфигурации)
- python-dateutil (для парсинга дат)

### Форматы экспорта Telegram
1. **HTML формат**: Сообщения в HTML файлах, видео в папке `files/`
2. **JSON формат**: Структурированные данные в JSON файлах

### Особенности
- Поддержка множественных экспортов одного канала
- Настраиваемые генераторы заголовков
- Валидация существования файлов перед публикацией
- Логирование всех операций

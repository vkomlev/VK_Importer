# Руководство по использованию

## Обзор

Система использует SQLite базу данных для отслеживания всех видео и их статуса загрузки. Перед загрузкой необходимо отсканировать экспорты и добавить видео в базу данных.

## Основные команды

### 1. Сканирование экспортов

Сканирует экспорты Telegram и добавляет видео в базу данных:

```bash
# Сканировать все экспорты из всех папок
python main.py scan

# Сканировать все экспорты из всех каналов
python main.py scan --source all_channels

# Сканировать только экспорты ЕГЭ
python main.py scan --source ege

# Сканировать только экспорты Python
python main.py scan --source python

# Сканировать только экспорты ОГЭ
python main.py scan --source oge

# Сканировать конкретную папку
python main.py scan --source "input/Экпорты ЕГЭ/Апрель 25"
```

**Важно:** При сканировании автоматически определяются дубликаты по хешу файла. Дубликаты не добавляются повторно.

### 2. Статистика

Показать статистику по видео в базе данных:

```bash
python main.py stats
```

### 3. Загрузка конкретного видео

Загрузить видео по его ID в базе данных:

```bash
python main.py upload-one 123
```

### 4. Загрузка следующего видео

Загрузить следующее не загруженное видео:

```bash
# Следующее видео из всех
python main.py upload-next

# Следующее видео из конкретного канала
python main.py upload-next --channel ЕГЭ

# Следующее видео из конкретной папки
python main.py upload-next --source "input/Экпорты ЕГЭ/Апрель 25"
```

### 5. Загрузка диапазона видео

Загрузить видео, начиная с указанного ID:

```bash
# Все видео начиная с ID 100
python main.py upload-range 100

# 10 видео начиная с ID 100
python main.py upload-range 100 --count 10

# С фильтрами
python main.py upload-range 100 --channel ЕГЭ --count 5
```

### 6. Загрузка нескольких видео

Загрузить несколько не загруженных видео:

```bash
# 5 следующих видео
python main.py upload-many --count 5

# Все видео из канала ЕГЭ
python main.py upload-many --channel ЕГЭ

# Все видео из конкретной папки
python main.py upload-many --source "input/Экпорты ЕГЭ/Апрель 25"
```

### 7. Загрузка всех видео

Загрузить все не загруженные видео с самого начала:

```bash
# Все не загруженные видео
python main.py upload-all

# Все видео из канала ЕГЭ
python main.py upload-all --channel ЕГЭ

# Все видео из конкретной папки
python main.py upload-all --source "input/Экпорты ЕГЭ/Апрель 25"
```

## Параметры загрузки

Все команды загрузки поддерживают следующие опции:

- `--delay` / `-d` - Задержка между загрузками в секундах (по умолчанию 5.0)
- `--max-retries` / `-r` - Максимальное количество повторных попыток при ошибке (по умолчанию 3)

Пример:

```bash
python main.py upload-next --delay 10 --max-retries 5
```

## Фильтры источников

При сканировании можно указать источник:

- `all` - все экспорты из всех папок (по умолчанию)
- `all_channels` - все экспорты из всех каналов (все папки в `input/`)
- `ege` - все экспорты ЕГЭ
- `python` - все экспорты Python
- `oge` - все экспорты ОГЭ по информатике
- путь к папке - конкретная папка экспорта

## Структура базы данных

База данных хранит следующую информацию о каждом видео:

- `id` - уникальный ID видео
- `file_path` - путь к файлу
- `file_hash` - хеш файла (для определения дубликатов)
- `title` - заголовок видео
- `description` - описание (текст сообщения)
- `channel` - канал (ЕГЭ, Python)
- `source_folder` - папка экспорта
- `date` - дата видео
- `uploaded` - статус загрузки (0/1)
- `upload_date` - дата загрузки
- `video_url` - URL загруженного видео в VK
- `post_url` - URL поста на стене
- `error_message` - сообщение об ошибке (если была)

## Типичный workflow

1. **Первое сканирование:**
   ```bash
   python main.py scan
   ```

2. **Проверка статистики:**
   ```bash
   python main.py stats
   ```

3. **Тестовая загрузка одного видео:**
   ```bash
   python main.py upload-one 1
   ```

4. **Загрузка следующих видео по одному:**
   ```bash
   python main.py upload-next
   ```

5. **Массовая загрузка:**
   ```bash
   python main.py upload-all --channel ЕГЭ
   ```

## Определение дубликатов

Система автоматически определяет дубликаты по SHA256 хешу файла. Если файл с таким же хешем уже существует в базе данных, он не добавляется повторно при сканировании.

## Повторное сканирование

Можно безопасно запускать сканирование повторно. Существующие видео будут обновлены (заголовок, описание), но статус загрузки сохранится.
